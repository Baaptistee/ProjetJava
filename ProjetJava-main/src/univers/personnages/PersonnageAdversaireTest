import org.junit.jupiter.api.Test;
import static org.junit.jupiter.api.Assertions.*;
import org.junit.jupiter.api.BeforeEach

import univers.Eleme;
import univers.competences.CompetencesActives;
import univers.personnages.PersonnageAdversaire;

import java.util.ArrayList;
import java.util.Arrays;
//import java.util.HashMap;
import java.util.Map;

public class PersonnageAdversaireTest {

    private PersonnageAdversaire adversaire;      
    private ArrayList<CompetencesActives> competences;  
    private CompetencesActives competence1;    

    @BeforeEach
    public void setUp(){
        CompetencesActives competence1 = new CompetencesActives("Competence1");
        CompetencesActives competence2 = new CompetencesActives("Competence2");
        ArrayList<CompetencesActives> competences = new ArrayList<>(Arrays.asList(competence1, competence2));
        int[] probaCompetences = {50, 50}; // 50% de chance pour chaque compétence
        PersonnageAdversaire adversaire = new PersonnageAdversaire("Adversaire", "Description", 10, 20, 15, 30, 5, 100, 50, new ArrayList<>(), new ArrayList<>(), competences, probaCompetences);
    }

    // Test de la méthode selectionAttaque
    @Test
    public void testSelectionAttaque() {
        // Sélection de l'attaque
        CompetencesActives attaque = adversaire.selectionAttaque();
        // Vérification que l'attaque sélectionnée est une des compétences du personnage
        assertTrue(competences.contains(attaque));
    }


    // test de la sélection de la cible blessée en cas de compétence de loin 
   @Test
    public void testSelectionCibleSoin() {
        PersonnageAdversaire adversaire2 = new PersonnageAdversaire("Adversaire2", "Description", 10, 20, 15, 30, 5, 100, 50, new ArrayList<>(), new ArrayList<>(), new ArrayList<>(), new int[]{});
        adversaire2.setLifePoints(getLifePoints()-1);
        CompetencesActives competenceSoin = new CompetencesActives("Soin");
        ArrayList<PersonnageCombattant> groupe = new ArrayList();
        groupe.add(adversaire);
        groupe.add(adversaire2);
        adversaire.setGroup(groupe);
        adversaire2.setGroup(groupe);
        competenceSoin.setGroup(false); // Définition de la compétence de soin comme ciblant un seul personnage 
        PersonnageCombattant cible = adversaire.selectionCible(competenceSoin);
        // Vérification que la cible sélectionnée est bien le personnage blessé
        assertTrue(cible.equals(adversaire2));
    }

    //Test de la sélection de cible ennemie 
    @Test
    public void testSelectionCible(){
        competence1.setGroup(false);
        PersonnageCombattant cible = adversaire.selectionCible(competence1);
        //Verification que la cible est dans le groupe joueur 
        assertTrue(Game.getGame().getGroupeJoueur().contains(cible));    
    }

    //test que quand la compétence est de groupe on retourne null
    @Test
    public void testSelectionCibleCompetenceGroup(){
        competence1.setGroup(true);
        PersonnageCOmbattant cible = adversaire.selectionCible(competence1);
        assertNull(cible);
    }


    // test quand personnage en vie 
    @Test
    public void testSelectionTout() {
        Map<PersonnageCombattant, Object[]> actions = new Map<PersonnageCombattant, Object[]>();
        adversaire.setAlive(true);
        int size = actions.size();
        Map<PersonnageCombattant, Object[]> newActions = adversaire.selectionTout(actions) ;

        assertTrue((size + 1)==newActions.size());
    }

    // test quand personnage Mort 
    @Test
    public void testSelectionToutQuandMort() {
        Map<PersonnageCombattant, Object[]> actions = new Map<PersonnageCombattant, Object[]>();
        adversaire.setAlive(false);
        int size = actions.size();
        Map<PersonnageCombattant, Object[]> newActions = adversaire.selectionTout(actions) ;
        assertTrue(size==newActions.size());
    }

}
